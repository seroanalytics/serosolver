---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# serosolver

[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)


`serosolver` is a modelling and inference package that uses a dynamic model to infer antibody dynamics and infection histories from cross-sectional or longitudinal serological data. The model infers individual-level infection histories, historical attack rates, and patterns of antibody dynamics by accounting for cross-reactive antibody responses and measurement error.

## Installation
1. Install [R][r-project]

2. Install the development version of serosolver from [GitHub](https://github.com/seroanalytics/serosolver):

```{r installation,eval=FALSE}
devtools::install_github("seroanalytics/serosolver")
library(serosolver)
```
## Quick start and vignettes

Read the [quick start vignette][vignette-doc] to set up and run a simple implementation with a simulation model.

There are additional Rmarkdown vignettes for [Case Study 1][c1-vignette-doc] (longitudinal analysis of influenza A/H1N1p in Hong Kong) and [Case Study 2][c2-vignette-doc] (cross-sectional analysis of influenza A/H3N2 in Guangzhou Province, China), to accompany the analysis in the serosolver paper.

[r-project]: http://cran.r-project.org
[vignette-doc]: https://seroanalytics.github.io/serosolver/articles/serosolver-quick_start_guide.html
[c1-vignette-doc]: https://seroanalytics.github.io/serosolver/articles/cs1_vignette.html
[c2-vignette-doc]: https://seroanalytics.github.io/serosolver/articles/cs2_vignette.html

## Example

This is a basic example of simulating some serological data and fitting the model using the MCMC framework.

```{r example, message=FALSE,warning=FALSE,eval=TRUE}
#library(serosolver)
library(ggplot2)
devtools::load_all("~/Documents/GitHub/serosolver")

## Load in example parameter values and antigenic map
data(example_par_tab)
data(example_antigenic_map)
data(example_antibody_data)
data(example_inf_hist)

plot_antibody_data(example_antibody_data,example_inf_hist,example_antigenic_map$inf_times,n_indivs=5)

## Run the MCMC
# This example uses prior version 2 (i.e. beta prior on phi with parameters alpha, beta)
# We have to remove the explicit specification of phi in the parameter table
res <- run_MCMC(example_par_tab, example_antibody_data, example_antigenic_map,
                filename="test", prior_version=2,
                mcmc_pars=c(adaptive_period=20000, iterations=80000))
## Read in the MCMC chains and plot posteriors
chain <- read.csv(res$chain_file)
inf_chain <- data.table::fread(res$history_file)
plot(coda::as.mcmc(chain[chain$sampno > 20000,c("boost_long","wane_short","posterior_prob")]))

# Plot model predicted titres for a subset of individuals
plot_model_fits(chain = chain,
                infection_histories = inf_chain,
                antibody_data = example_antibody_data,individuals=c(1:4),
                antigenic_map=example_antigenic_map,
                par_tab=example_par_tab,
                orientation="cross-sectional")

```
